<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Crochê</title>
</head>
<body>
  <a href="../config/perfil.php">
    <button style="margin-top: 15px;">Perfil</button>
  </a>
  <form id="form-projeto">
    <label>Nome do Projeto:</label>
    <input type="text" name="nome" required><br>

    <label>Agulha utilizada:</label>
    <input type="text" name="agulha" required><br>

    <label>Padrão de crochê:</label>
    <input type="text" name="padrao" required><br>

    <button type="button" onclick="calcularProjeto()">Calcular</button>
  </form>

  <div id="resultado" style="margin-top:20px;"></div>
  <button id="btn-salvar" style="display:none;" onclick="salvarProjeto()">Salvar no Perfil</button>

  <script>
    let projetoCalculado = {};
  
    function calcularProjeto() {
      const form = document.getElementById('form-projeto');
      const nome = form.nome.value;
      const agulha = form.agulha.value;
      const padrao = form.padrao.value;
  
      // Simulação de cálculo, apagar quando a calculadora estiver pronta
      const gramas = "200g";
      const tempo = "3h";
      const uso = "180g";
  
      projetoCalculado = { nome, agulha, padrao, gramas, tempo, uso };
  
      document.getElementById('resultado').innerHTML = `
        <h3>Resultado:</h3>
        <p><strong>Nome:</strong> ${nome}</p>
        <p><strong>Agulha:</strong> ${agulha}</p>
        <p><strong>Gramas:</strong> ${gramas}</p>
        <p><strong>Tempo estimado:</strong> ${tempo}</p>
        <p><strong>Uso estimado:</strong> ${uso}</p>
      `;
  
      document.getElementById('btn-salvar').style.display = 'inline-block';
    }
  
    function salvarProjeto() {
      const form = document.getElementById('form-projeto');
      const dados = new FormData(form);
  
      dados.append("gramas", projetoCalculado.gramas);
      dados.append("tempo", projetoCalculado.tempo);
      dados.append("uso", projetoCalculado.uso);
  
      fetch('../config/salvar.php', {
        method: 'POST',
        body: dados
      })
      .then(res => res.json())
      .then(res => {
        alert(res.mensagem);
        document.getElementById('btn-salvar').style.display = 'none';
        form.reset();
        document.getElementById('resultado').innerHTML = '';
      })
      .catch(err => {
        console.error("Erro ao salvar:", err);
        alert("Erro ao salvar o projeto. Veja o console.");
      });
    }
  </script>
</body>
</html>
